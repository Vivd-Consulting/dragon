table:
  name: transactions
  schema: accounting
object_relationships:
  - name: account
    using:
      foreign_key_constraint_on: account_id
  - name: gicCategory
    using:
      foreign_key_constraint_on: gic_category_id
  - name: invoice
    using:
      foreign_key_constraint_on: invoice_id
  - name: invoice_item
    using:
      foreign_key_constraint_on: invoice_item_id
  - name: personalCategory
    using:
      manual_configuration:
        column_mapping:
          category_id: id
        insertion_order: null
        remote_table:
          name: personal_finance_category
          schema: accounting
  - name: relatedTransaction
    using:
      foreign_key_constraint_on: related_transaction_id
array_relationships:
  - name: recommendations
    using:
      foreign_key_constraint_on:
        column: recommended_transaction_id
        table:
          name: transactions_recommendations
          schema: accounting
  - name: transactions
    using:
      foreign_key_constraint_on:
        column: related_transaction_id
        table:
          name: transactions
          schema: accounting
  - name: transactions_recommendations
    using:
      foreign_key_constraint_on:
        column: transaction_id
        table:
          name: transactions_recommendations
          schema: accounting
event_triggers:
  - name: new-transaction
    definition:
      enable_manual: false
      insert:
        columns: '*'
    retry_conf:
      interval_sec: 10
      num_retries: 0
      timeout_sec: 60
    webhook: '{{ACTION_API}}/events/transactions/alert'
    headers:
      - name: action-secret
        value_from_env: ACTION_SECRET
    request_transform:
      body:
        action: transform
        template: |-
          {
            "table": {
              "name": {{$body.table.name}},
              "schema": {{$body.table.schema}}
            },
            "data": {{$body.event.data.new}}
          }
      template_engine: Kriti
      version: 2
